## 교착 상태 
#### 공부 날짜: 2024/06/29

<br><br>
### 키워드
- 교착 상태(deadlock)
- 비관적인 락(Pessimistic Lock)
- 상호배제
- 비선점
- 점유와 대기 
- 순환대기 
- 예방 
- 회피
- 은행원 알고리즘
- 검출 후 회복 



<br> 

### 교착 상태(deadlock)란? 
> 일어나지 않을 사건을 기다리며 **진행이 멈춰 버리는 현상**

> 두 개 이상의 프로세스나 스레드가 **서로 자원을 얻지 못해** 다음 처리를 하지 못하는 상태(무한히 다음 자원을 기다리는 현상)

<br><br>

### 데드락 발생 조건 
아래의 조건이 **모두 성립**해야 데드락이 발생할 가능성이 생긴다. 

#### 1. 상호 배제(Mutual exclusion) 
* 자원은 한 번에 한 프로세스만 사용이 가능하다. 
* 즉 **자원을 공유해서 사용할 수 없다.**

#### 2. 점유 대기(Hold and wait)
* 자원을 가진 프로세스가 다른 자원을 기다릴 때 **보유 자원을 놓지 않고 계속 가지고 있다.**

#### 3. 비선점(No preemption)
* 다른 프로세스에 할당된 자원은 사용이 끝날 때까지 강제로 뺏을 수 없다. 

#### 4. 순환대기(Circular wait)
* 자원을 기다리는 프로세스 간에 **사이클**이 형성되어야 한다. 
* 즉 프로세스들이 **순환 형태로 서로의 리소스를 기다린다.**

<br><br>

### 데드락 해결 방법
크게 3가지 방법이 있다. **예방,회피,검출 후 회복**이다. 

1. **예방** : 데드락 발생 조건 4가지 중 **어느 하나가 만족되지 않도록 하는 것** , 시스템 레벨에서 설계를 통해 데드락이 발생할 조건 하나를 없앤다. 
   1. 상호 배제(Mutual exclustion) 부정: 여러 프로세스가 모든 자원을 공유해서 사용한다. 하지만 현실에서 사용하기에 다소 무리가 있다. 
   2. 점유 대기(Hold and wait) 부정: 프로세스에 자원을 모두 할당하거나, 아예 할당하지 않게한다. 하지만 이럴 경우 **자원의 활용률이 낮아질 수 있다.** 또한 많은 자원을 필요로 하는 프로세스는 무한정 자원을 기다리는 **기아 현상**이 발생할 수 있다. 
   3. 비선점(No preemption) 부정: 자원을 이용중인 프로세스로부터 해당 자원을 뺏어 사용할 수 있다. **state를 쉽게 save하고 restore 할 수 있는 자원인 CPU나 메모리에서 주로 사용한다.** 프린터 같은 자원은 도중에 빼앗아 사용하기 어렵다. 즉, 모든 자원을 빼앗는 건 다소 범용성이 떨어진다. 
   4. 순환대기(Circular wait) 부정: **가장 많이 사용**한다. 모든 자원에 **번호를 붙이고, 오름차순으로 자원을 할당**한다. 하지만 모든 자원에 번호를 붙이는 일이 간단하지 않고, 각 자원에 어떤 번호를 붙이는지에 따라 **특정 자원의 활용률이 떨어질 수 있다.**

<br>

2. **회피** : 교착 상태가 발생하지 않을 정도로만 **조심 조심 자원을 할당**하는 방식이다. 
   * 안전 상태(safe state): 교착상태가 발생하지 않고, 모든 프로세스가 정상적으로 자원을 할당받고 종료될 수 있는 상태 
   * 불안전 상태(unsafe state): 교착상태가 발생할 수도 있는 상황 
   * 안전 순서열(safe sequence): 교착 상태없이 안전하게 프로레스들에 자원을 할당할 수 있는 순서 

=> 교착 상태 회피 방식은 항시 안전 상태를 유지하도록 자원을 할당하는 방식이다. 

> 은행원 알고리즘: 은행에서 모든 고객의 요구가 충족되도록 현금을 할당하는데서 유래한다.  <br>
> 프로세스가 자원을 요구할 때, 시스템이 자원을 할당한 후에도 안정 상태로 남아있게 되는지 사전에 검사해 교착 상태를 회피한다. 안정 상태면 자원을 할당하고 아니면 다른 프로세스들이 자원을 해지할때까지 대기한다. 

<br>

3. **교착 상태 검출 후 회복**: 교착 상태 발생을 인정하고 사후에 조치하는 방식이다.
   1. 선점을 통한 회복: 교착상태가 해결될 때까지 **한 프로세스씩 자원을 몰아주는 방법**
   2. 프로세스 강제 종료를 통한 회복: 교착 상태를 해결할 수 있는 확실한 방법이지만 그만큼 많은 프로세스들의 **작업 내역을 잃게 될 가능성**이 있다. 


<br><br>

#### 참고 자료
[자료 1](https://github.com/devSquad-study/2023-CS-Study/blob/main/OS/os_deadLock.md)

[자료 2](https://gyoogle.dev/blog/computer-science/operating-system/DeadLock.html) 